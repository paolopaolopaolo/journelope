function newId(){"use strict";var t,e;return t=Math.random().toString().slice(2),e=Math.random().toString().slice(2),t+"_"+e}function createAndAppendImgDivs(t,e,i,n){"use strict";var a,r,o;o=void 0!==t?t:newId,a=$(document.createElement("div")),a.attr({id:o(),"class":"upload-image"}),r=$(document.createElement("img")),r.attr("src",e),a.objectSettings(RESIZE_OBJECT_SETTINGS),a.css(i),r.css(IMG_SETTINGS),a.append(r),n.append(a)}function stringConvJStoHTML(t){"use strict";var e,i,n,a;if(is_firefox)return UtilityHiddenFunctions.sanitizeText(t).replace(/<br>/g,"").replace(/\n/g,"<br>");for(e="",i=t.split("\n"),a=0;a<i.length;a++)n=""===i[a]?"<br>":UtilityHiddenFunctions.sanitizeText(i[a]),e+="<div>"+n+"</div>";return e}var RESIZE_OBJECT_SETTINGS,IMG_SETTINGS,UtilityHiddenFunctions,is_firefox,is_chrome,is_explorer,is_Opera,is_safari;is_chrome=navigator.userAgent.indexOf("Chrome")>-1,is_explorer=window.hasOwnProperty("ActiveXObject"),is_firefox=navigator.userAgent.indexOf("Firefox")>-1,is_safari=navigator.userAgent.indexOf("Safari")>-1,is_Opera=navigator.userAgent.indexOf("Presto")>-1,is_chrome&&is_safari&&(is_safari=!1),function(t,e,i){"use strict";function n(i,n,a){var r,o,s,c,l,d,p,u,g;u=Math.random().toString().slice(2),g=Math.random().toString().slice(2),u+="_"+g,void 0!==n?(c=new Image,r=t(c),r.attr("src",i)):r=t(i),r[0].onload=function(){return r[0].width<=0||r[0].height<=0?(alert("Upload Error! Try again\n"),!1):(s=e.createElement("div"),s.setAttribute("contenteditable","false"),s.setAttribute("class","upload-image"),o=t(s),p=parseInt(a.css("height").replace("px",""),10),r[0].height>p?(d=p/2,l=r[0].width/r[0].height*d):(d=r[0].height,l=r[0].width),o.css({top:a.scrollTop().toString()+"px",left:"10px",width:l+"px",height:d+"px"}),o.attr("id",u),o.objectSettings(RESIZE_OBJECT_SETTINGS),r.objectSettings(IMG_SETTINGS),o.append(r),o.imgInteract(),void a.append(o))}}function a(t,e){function i(t){var i=new FileReader;i.onload=function(a){a.preventDefault(),a.stopPropagation(),n(i.result,t,e,RESIZE_OBJECT_SETTINGS,IMG_SETTINGS)},i.onerror=function(){alert("Upload Failed! Try again.")},i.readAsDataURL(t)}var a,r,o,s;if(t.preventDefault(),t.stopPropagation(),a=t.originalEvent.dataTransfer,r=a.files,r.length<=0&&(o=t.originalEvent.dataTransfer.getData("URL")),void 0!==o)alert("Try copy-pasting the image instead!");else for(s=0;s<r.length;s++)i(r[s]);e.attr("contenteditable","true")}function r(t,a){var r,o,s,c,l,d,p;if(l=/[^\.\\\/?<>:*|"']*\.(jpg|jpeg|gif|png|bmp|tiff)*/gi,d=/data:image\/[\w]+;base64,[^,\:\"]+/gi,p=/<!--StartFragment-->(<img[^>]*>)<!--EndFragment-->/,t.preventDefault(),i.clipboardData?(o=i.clipboardData.getData("URL"),r="<img src='"+o+"'/>",c=i.clipboardData.getData("text"),s=""===o||void 0===o?c:l.test(o)?r:c):t.originalEvent.clipboardData&&(o=t.originalEvent.clipboardData.getData("text/html"),c=t.originalEvent.clipboardData.getData("text/plain"),is_chrome||is_safari?(r=o.match(p),s=null!==r&&(l.test(r[1])||d.test(r[1]))?r[1]:c):(r=o,s=l.test(r)||d.test(r)?r:c)),(""===o||void 0===s)&&(""===c&&(alert("Try dragging and dropping the image!"),c=""),s=c),s.indexOf("<img")>-1)n(s,void 0,a,RESIZE_OBJECT_SETTINGS,IMG_SETTINGS);else try{i.document.execCommand?i.document.execCommand("insertText",!1,s):e.execCommand&&e.execCommand("insertText",!1,s)}catch(u){}}t.fn.suppressDefaults=function(){this.on("dragover",function(t){t.stopPropagation(),t.preventDefault()}),this.on("dragenter",function(t){t.stopPropagation(),t.preventDefault()})},t.fn.attachDeleteButton=function(){var e,i,n;e=this,this.find(".delImg").length<1?(i=document.createElement("input"),i.setAttribute("type","submit"),i.setAttribute("value","X"),i.setAttribute("class","delImg"),n=t(i),n.attr("id","delImg_"+e[0].id),n.css({position:"relative",bottom:"99%","float":"right",right:"1px",display:"none"}),e.append(n)):(n=t("#delImg_"+e[0].id.replace(".","\\.")),console.log(n)),e.hover(function(){n.show()},function(){n.hide()}),n.on("click",function(e){e.preventDefault(),e.stopPropagation(),t(this).parent().remove()})},t.fn.imgEvent=function(){var t=this;t.on("drop",function(e){a(e,t)}),t.on("paste",function(e){r(e,t)})},t.fn.tabEnable=function(){var t=this;t.on("keydown",function(t){9===t.which&&(t.preventDefault(),is_firefox?e.execCommand("insertHTML",!1,"&emsp;"):i.document.execCommand("insertText",!1,"	"))})},t.fn.ctrlFormatting=function(){var t=this;t.on("keydown",function(t){t.ctrlKey&&("b"===t.key&&(t.preventDefault(),e.execCommand("bold",!1)),"i"===t.key&&(t.preventDefault(),e.execCommand("italic",!1)),"u"===t.key&&(t.preventDefault(),e.execCommand("underline",!1)))})},t.fn.imgInteract=function(){this.draggable({containment:"parent"}),this.resizable({containment:"parent",handles:"s, e, se, w, sw"}),this.attachDeleteButton(),is_chrome&&this.find(".ui-icon-gripsmall-diagonal-se").attr({"class":["ui-resizable-handle ui-res","izable-se ui-icon-gripsmal","l-diagonal-se"].join("")})},t.fn.primeDivs=function(){is_firefox||this.html("<div><br></div>")},t.fn.setCopyData=function(){var t;this.on("keydown",function(t){(t.ctrlKey||17===t.which)&&("a"===t.key||65===t.which)&&(t.preventDefault(),e.execCommand?e.execCommand("selectAll",!0,null):i.document.execCommand&&i.document.execCommand("selectAll",!0,null))}),this.on("copy",function(n){n.preventDefault(),i.getSelection?t=i.getSelection().toString():e.selection&&(t=e.selection.createRange()),i.clipboardData?i.clipboardData.setData("Text",t):n.originalEvent.clipboardData&&n.originalEvent.clipboardData.setData("text/plain",t),e.execCommand("copy")})},t.fn.objectSettings=function(t){var e=this;e.css(t)}}(jQuery,document,window),UtilityHiddenFunctions={repeatEscape:function(t,e){"use strict";var i,n,a;for(i=!1,n=!1,a=t.exec(e);!i||!n;)null===a?(i&&(n=!0),i=!0):(e=e.replace(a[0],"<"+a[1]+">"),n=!1,i=!1),a=t.exec(e);return e},sanitizeText:function(t){"use strict";var e,i,n,a;for(e=/<([^>]*)>/gm,i=/&lt;(\/*[biu]|br)&gt;/gm,n=/&lt; *(\/*span[ \w\d\-\_="`':]*) *&gt;/gm,a=e.exec(t);null!==a;)t=t.replace(a[0],"&lt;"+a[1]+"&gt;"),a=e.exec(t);return t=this.repeatEscape(i,t),t=this.repeatEscape(n,t)}},$.fn.refreshImgInteractions=function(){"use strict";var t,e;for(t=this.find(".upload-image"),e=0;e<t.length;e++)$(t[e]).contents().remove("div.ui-resizable-handle"),$(t[e]).unbind(),$(t[e]).imgInteract();t.on("click",function(){t.css("z-index","0"),$(this).css("z-index","10")})},$.fn.imgSrc=function(){"use strict";var t,e,i,n,a,r,o,s,c,l,d,p;for(t=[],e=this.find("img"),p=0;p<e.length;p++)n=$(e[p]).parent().attr("id"),a=$(e[p]).parent().css("top"),r=$(e[p]).parent().css("left"),o=$(e[p]).parent().css("height"),s=$(e[p]).parent().css("width"),c=e[p].src,c.indexOf("base64")>-1?(l=c.indexOf("base64")+7,d=c.slice(l,c.length)):d=c,i={id:n,top:a,left:r,height:o,width:s,data:d},t.push(i);return t},$.fn.stringConvHTMLtoJS=function(){"use strict";var t,e,i,n,a;return t="",e="",is_firefox?(i=this,n=i.html(),a=n.indexOf("<div"),t+=UtilityHiddenFunctions.sanitizeText(n.slice(0,a).replace(/<br>/g,"\n"))):(i=this.contents().not(".upload-image"),i.each(function(){e+=$(this).html()+"\n"}),e=UtilityHiddenFunctions.sanitizeText(e.replace(/&nbsp;/g," ")),t+=e),t},$.fn.imgTxtHybrid=function(t){"use strict";var e,i,n;if(e={overflow:"hidden",position:"absolute","white-space":"pre-wrap",display:"inline-block"},RESIZE_OBJECT_SETTINGS=e,void 0!==t.imagecss)try{RESIZE_OBJECT_SETTINGS=e,n=t.imagecss;for(i in n)n.hasOwnProperty(i)&&(RESIZE_OBJECT_SETTINGS[i]=n[i])}catch(a){console.log(a)}IMG_SETTINGS={display:"block",width:"100%",height:"100%"},this.attr("contenteditable","true"),this.css({position:"relative",overflow:"auto","white-space":"pre-wrap"}),this.suppressDefaults(),this.primeDivs(),this.imgEvent(),this.tabEnable(),this.ctrlFormatting(),this.setCopyData()};